---
layout: post
title: 惰性函数
subtitle: 惰性函数
date: 2020-05-20
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - 函数式编程
---

# 需求

> 写一个函数，这个函数返回首次调用的 date 对象

**写法一**

缺点：每次都要进行一次判断，并且污染全家变量

```
var t;
function foo(){
  if(t) return t;
  t=new Date();
  return t
}
```

**写法二采用闭包**
采用闭包虽然没有污染全局变量，单也要每次进行判断

```
function foo(){
  var t;
  return function(){
    if(t)return t;
    t=new Date()
    return t
  }
}()
```

**写法三函数对象**
利用函数也是个对象这种特质,但这种方法也需要每次判断。函数声明是可以对函数名进行可读可写的。表达式只可读

```

function foo(){
  if(foo.t)return foo.t;
  foo.t=new Date;
  return foo.t
}
```

**运用惰性函数**
当函数第一次执行的时候将调用新函数，并返回值，后续调用仅返回返回值。t 将保存在闭包中。

```
function foo(){
  var t=new Date();
  foo=function(){
    return t
  }
  return foo()
}
```

**惰性函数的其他应用**
DOM 事件添加中，为了浏览器的兼容我们需要进行判断

```
function addEvent (type, el, fn){
  if(window.addEventListner){
    addEvent=function(type,el,fn){
       el.addEventListener(type, fn, false);
    }
  }else if(window.attachEvent){
      addEvent = function (type, el, fn) {
            el.attachEvent('on' + type, fn);
        }
  }
}
addEvent()
```

**总结：所谓的惰性函数就是对函数进行重写，以后调用该函数实际调用的是重写的函数。当我们每次只需进行一次判断的时候，并且接下来的使用方式都不会改变，可以考虑使用懒性函数**

# 参考

https://github.com/mqyqingfeng/Blog/issues/44
