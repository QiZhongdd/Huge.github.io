---
layout: post
title: http2的总结
subtitle: http2的总结
date: 2020-06-28
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - http
---

# 简介
HTTP/2 没有改动 HTTP 的应用语义。 HTTP 方法、状态代码、URI 和标头字段等核心概念一如往常。http2主要修改了两点，第一是数据格式化，采用分帧的方式对传输内容封装成二进制，第二是改变了客户端与服务端的传输方式
**http2的特点如下：**
- 采用二进制对内容进行传输，更高效更紧凑
- 对报头进行了压缩，降低开销
- 服务器能主动推送，类似socket。所以在http2中就使用不了ajax
- 默认使用加密，http2要求强制申请证书

**http1.1到http2的协商过程**
http1.1升级到http2是一个协商过程，首先http1.1发送请求，服务端会发起升级协商，问浏览器需不需要升级到http2，如果需要就升级，不需要就继续使用http1.1。客户端会把使用的http版本缓存下来，下次请求的时候就直接采用缓存的协议版本。

# 二进制分帧层

 HTTP/1.x 协议以换行符作为纯文本的分隔符，而 HTTP/2 将所有传输的信息分割为更小的消息和帧，并采用二进制格式对它们编码。头信息和数据体都是二进制，并且统称为帧（frame）：头信息帧和数据帧。
 ![Image text](/img/WechatIMG26.png)


# 多路复用

Http2复用TCP链接，在一个tcp连接中，可以同时进行多个请求和响应，而且不用按照顺序一一对应，及时有一个请求被堵塞了，也不会影响其他请求，这就避免了Http1.1中的队头堵塞

![Image text](/img/WechatIMG288.png)

 HTTP/2 的多路复用技术流程：
 - 将多个请求复用同一个 TCP 链接中，将TCP连接分成多个数据流，每个数据流可以有多个消息。可以把数据流当成管道，在这个管道中传输请求和响应的消息。
 - 消息就是传输的内容（请求消息和响应消息），会被分割成帧，帧是最小的通信单位，承载着特定类型的数据，至少也会标识出当前帧所属的数据流。
 - 来自不同数据流的帧会交错发送给服务器和客户端，然后再根据每个帧头的数据流标识符重新组装。
![Image text](/img/WechatIMG50.png)

# 服务器推送
HTTP/2 新增的另一个强大的新功能是，服务器可以向客户端主动推送资源，而无需客户端明确地请求。 打破了严格的请求-响应语义。实现了类似socket类似的功能，但它比socket更轻便,并且http2能多个界面响应，socket的只能在单个界面响应。
微信的扫码登录，当我们在手机端扫码登录发送登录请求，这个时候http2就会主动推动内容给pc端，改变pc端微信的登录状态。
![Image text](/img/WechatIMG30.png)

# 伪头字段
http2的伪头字段只根据请求行和响应行，由于http2对消息进行了分帧处理，是没有办法具体得到请求行或者响应行的相关信息，所以http2设立了伪头字段将请求行信息暴露处理，供人查看。具体的伪头字段如下：
- :method 目标URL模式部分，对应请求的method（请求）
- :scheme 目标URL模式部分（请求）对应协议版本
- :authority 目标RUL认证部分（请求），对应请求的url
- :path 目标URL的路径和查询部分（绝对路径产生式和一个跟着""字符的查询产生式）。（请求）
- :status 响应头中的HTTP状态码部分（响应）

![Image text](/img/WechatIMG29.png)


# 参考
https://lmjben.github.io/blog/osi-http.html#http-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%8E%86%E5%8F%B2%E6%BC%94%E5%8F%98
