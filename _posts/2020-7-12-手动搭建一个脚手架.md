---
layout: post
title: 手动搭建一个脚手架
subtitle: 手动搭建一个脚手架
date: 2020-07-12
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - 其他
---

# 简介

手动搭建 cli 主要是为了减少平时重复搭建架构，同时在平时开发中不想引用 vue-cli 和 react-cli,因为不能随意改造这两个 cli。

# 搭建步骤

**创建目录，使用 npm init 初始化**
**npm instal 相关的包，commander ，shelljs 必须按照**

- commander 是用于 node.js 命令行界面的完整解决方案，主要是为了定义相关对的命令，同时获取命令行执行相关的 handler.
- ShellJS 是在 Node.js API 之上的 Unix shell 命令的可移植实现,使用 shelljs 主要是为了自动执行相关操作命令与系统进行交互。

**建立 bin 文件夹和 cli 文件**

```
-bin
- - xx-cli
```

**编写 xx-cli**

- 引入 commander 和 shelljs

```
const shell = require("shelljs");
);
const { program } = require("commander");

```

- 利用 commader 设立脚手架相关的命令

```
program
  .option("-c,create", "创建一个组件")
  .option("-j,json2ts", "集成quicktype");

program.parse(process.argv);//一定要加，不然无法解析命令行
```

利用 node ./bin/xx-cli --help 可以查看相关的命令

```
  -V, --version  output the version number
  -c,create      创建一个组件
  -j,json2ts     集成quicktype
  -h, --help     display help for command
```

- 利用 commander 获取用户输入的命令行，执行相关的 handle，handler 里面用 shelljs 执行相关的 shell 命令

```
const handlers = {
  json2ts(dataURL) {
    shell.exec(
      `quicktype ${dataURL} -o ${
        shell.pwd().stdout
      }/Weather.ts --runtime-typecheck`
    );
  },
};

program
  .usage("[cmd] <options>")
  .arguments("<cmd> [env]")
  .action((cmd, otherParams) => {
    console.log(cmd, otherParams);
    const handler = handlers[cmd];
    if (typeof handler == "undefined") {
      console.log(chalk.blue(`${cmd}`) + chalk.red("暂未支持"));
    } else {
      handler(otherParams);
    }
  });
```

- 将脚手架按照到全局
- - 在 cli 文件的首行添加#!/usr/bin/env node，主要是为了让系统看到这一行的时候，会沿着该路径去查找 node 并执行,能够适应不同的操作系统

```
!/usr/bin/env node

```

- - 在 package.json 添加 bin

```
"bin":{
 xxcli:bin/xx-cli
}
```

- - 使用 npm link 就可将 cli 挂载到全局

```
npm link

```

- - 按照完后就可以使用 xxcli 执行文件，不需要在用 node ./bin/xxcli 了

- 发布 npm 包,然后安装 npm install -g xxcli，就可以将包安装至全局 -

# 总结

搭建一个完整的主要有以下几个步骤

- 首先搭建一个完整的 cli。
- 然后运用 shelljs 与用户进行交互，根据用户的选择下载 git 中的项目模板
- 然后运用 shelljs 修改模板项目的文件，比如 package.json 中的 name 等
- 帮用户 npm install 相关的包，准备开始工作。
