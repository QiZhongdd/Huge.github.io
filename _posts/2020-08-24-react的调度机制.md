---
layout: post
title: React的调度机制
subtitle: React的调度机制
date: 2020-08-22
author: Qi
header-img: img/404-bg.jpg
catalog: true
tags:
  - react
---

# fiber 调度简介

**为什么要有 fiber 调度**

> react16 之前，react 更新时采用自顶向下递归，更新整个子树，并且不可打断，不可取消。所以如果节点较多，主线程就会一直被占用，会造成页面的掉帧，就会出现卡顿，

**fiber 调度分为 reconciliation 阶段和 commit 阶段**

- reconciliation 阶段

> fiber 在执行的时候会以 fiber 为单位，在 reconciliation 阶段，每执行一个 fiber 前，都会询问是否有优先级别更高的任务，如果有那么就中断当前执行，去执行优先级更高的任务，等到执行完优先级更高的任务，会立即回到当前任务执行（链表结构的特殊性，能快速找到先前的执行任务），这个阶段会进行 dom diff， 生成 workInProgressTree,并标记好所有的 side effect

- commit 阶段

> commit 阶段阶段执行所有的 side Effect，不可打断
